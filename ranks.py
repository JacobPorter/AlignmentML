l1 = ['dkg_2', 'entropy_3', 'freq_C_3', 'dust_1', 'freq_T_3', 'freq_C', 'dust_3', 'run_variance', 'freq_A_2', 'qual_variance', 'qual_mean_3', 'run_mean', 'entropy_2', 'run_max_length', 'freq_T', 'freq_A', 'dust', 'dust_2', 'freq_G', 'freq_A_3', 'entropy_1', 'qual_variance_3', 'entropy', 'freq_G_1', 'qual_mean', 'freq_T_2', 'freq_G_3', 'freq_G_2', 'freq_C_1', 'bz2_2', 'freq_A_1', 'rkg_5', 'bz2_1', 'rkg_4', 'bz2_3', 'dkg_5', 'freq_T_1', 'rkg_3', 'rkg_2', 'dkg_3', 'bz2', 'dkg_4', 'qual_mean_2', 'freq_C_2', 'qual_mean_diff_3', 'qual_mean_diff_2', 'qual_mean_1', 'qual_variance_1', 'qual_variance_2', 'qual_skewness_3', 'qual_skewness_1', 'qual_mean_diff', 'qual_skewness_2', 'qual_skewness', 'lzma_3', 'lzma_2', 'lzma', 'qual_mean_diff_1', 'lzma_1', 'qual_min_3', 'qual_max_2', 'qual_max_3', 'qual_max_1', 'qual_max', 'qual_min_2', 'qual_min', 'qual_min_1']
l2 = ['dkg_2', 'freq_C_3', 'freq_C', 'dust_1', 'dkg_3', 'freq_T_3', 'dust_3', 'entropy_2', 'run_max_length', 'freq_T', 'run_variance', 'dust', 'entropy_3', 'rkg_3', 'freq_G', 'freq_A', 'freq_G_1', 'run_mean', 'dust_2', 'entropy_1', 'freq_A_2', 'freq_A_3', 'entropy', 'freq_G_2', 'qual_variance', 'bz2_2', 'freq_T_2', 'freq_A_1', 'freq_G_3', 'rkg_5', 'bz2_1', 'freq_C_1', 'rkg_4', 'dkg_5', 'bz2_3', 'qual_mean', 'freq_T_1', 'qual_mean_3', 'bz2', 'dkg_4', 'qual_variance_3', 'rkg_2', 'qual_mean_2', 'qual_mean_diff_3', 'qual_mean_diff_2', 'qual_mean_1', 'qual_variance_1', 'lzma_1', 'qual_variance_2', 'lzma_2', 'qual_skewness_1', 'lzma', 'qual_skewness_2', 'qual_skewness_3', 'qual_mean_diff_1', 'qual_mean_diff', 'lzma_3', 'freq_C_2', 'qual_min_3', 'qual_skewness', 'qual_max_2', 'qual_max_3', 'qual_max_1', 'qual_max', 'qual_min_2', 'qual_min', 'qual_min_1']
l3 = ['bz2_2', 'lzma_2', 'lzma_1', 'qual_mean', 'dust', 'rkg_5', 'freq_T', 'freq_A', 'bz2_1', 'run_mean', 'freq_G', 'entropy', 'freq_C', 'qual_mean_diff_2', 'run_variance', 'qual_mean_diff_1', 'dust_2', 'dust_1', 'rkg_3', 'dust_3', 'qual_mean_2', 'dkg_5', 'qual_mean_diff_3', 'entropy_3', 'entropy_2', 'entropy_1', 'rkg_4', 'freq_G_3', 'qual_variance', 'freq_C_1', 'qual_mean_diff', 'qual_mean_3', 'freq_G_1', 'freq_C_2', 'qual_mean_1', 'freq_G_2', 'freq_C_3', 'freq_T_3', 'freq_A_3', 'freq_T_1', 'freq_A_1', 'freq_T_2', 'freq_A_2', 'qual_variance_3', 'bz2_3', 'qual_variance_2', 'dkg_4', 'bz2', 'qual_variance_1', 'dkg_3', 'lzma', 'dkg_2', 'rkg_2', 'qual_min_3', 'lzma_3', 'qual_min_2', 'qual_min_1', 'qual_min', 'run_max_length', 'qual_skewness_1', 'qual_max_2', 'qual_max_1', 'qual_max_3', 'qual_skewness_2', 'qual_max', 'qual_skewness_3', 'qual_skewness']
l4 = ['bz2_2', 'dust', 'bz2_1', 'freq_T', 'freq_A', 'lzma_2', 'run_variance', 'run_mean', 'entropy', 'freq_G', 'freq_C', 'dust_1', 'dust_3', 'qual_mean_diff_2', 'dust_2', 'qual_mean_diff_1', 'entropy_2', 'rkg_3', 'entropy_3', 'entropy_1', 'dkg_5', 'freq_C_1', 'rkg_2', 'qual_mean_diff_3', 'freq_G_3', 'freq_C_3', 'rkg_5', 'freq_G_1', 'freq_C_2', 'freq_G_2', 'rkg_4', 'qual_mean_diff', 'freq_A_2', 'freq_A_3', 'freq_T_1', 'freq_A_1', 'freq_T_3', 'freq_T_2', 'qual_mean_3', 'qual_mean_2', 'qual_mean_1', 'lzma_3', 'qual_variance_3', 'qual_variance_2', 'qual_mean', 'qual_variance_1', 'dkg_3', 'bz2', 'qual_variance', 'dkg_4', 'bz2_3', 'lzma', 'run_max_length', 'dkg_2', 'qual_min_3', 'qual_min_2', 'qual_min_1', 'lzma_1', 'qual_min', 'qual_skewness_1', 'qual_max_2', 'qual_max_1', 'qual_max_3', 'qual_skewness_2', 'qual_max', 'qual_skewness_3', 'qual_skewness']
l5 = ['freq_T_3', 'freq_G_3', 'freq_C', 'freq_A_3', 'entropy_3', 'qual_variance_1', 'freq_C_3', 'run_variance', 'freq_T_2', 'dust_2', 'freq_A_1', 'freq_C_2', 'qual_mean_2', 'qual_mean_1', 'freq_A_2', 'dkg_5', 'dust', 'run_mean', 'dkg_3', 'freq_G_2', 'entropy_1', 'freq_C_1', 'qual_mean_3', 'qual_variance_2', 'entropy', 'entropy_2', 'freq_A', 'dust_3', 'freq_T', 'rkg_5', 'dust_1', 'qual_skewness_3', 'freq_T_1', 'qual_mean_diff_2', 'qual_variance', 'rkg_4', 'freq_G_1', 'qual_mean', 'freq_G', 'qual_mean_diff_1', 'rkg_3', 'run_max_length', 'dkg_4', 'qual_skewness_1', 'bz2', 'qual_mean_diff_3', 'qual_mean_diff', 'bz2_3', 'bz2_2', 'bz2_1', 'lzma', 'qual_skewness_2', 'qual_variance_3', 'qual_max_1', 'qual_skewness', 'lzma_2', 'qual_max_3', 'dkg_2', 'lzma_3', 'qual_max_2', 'rkg_2', 'lzma_1', 'qual_max', 'qual_min_3', 'qual_min_1', 'qual_min_2', 'qual_min']
l6 = ['bz2_1', 'bz2_3', 'bz2_2', 'entropy', 'freq_T', 'bz2', 'dust', 'freq_G', 'run_variance', 'run_mean', 'freq_C', 'freq_A', 'freq_G_1', 'freq_A_1', 'freq_T_2', 'dust_2', 'dust_1', 'freq_G_2', 'dust_3', 'freq_G_3', 'entropy_2', 'freq_T_1', 'freq_C_2', 'freq_A_2', 'freq_A_3', 'freq_T_3', 'qual_mean', 'rkg_4', 'entropy_3', 'qual_mean_2', 'entropy_1', 'dkg_5', 'rkg_5', 'qual_mean_1', 'qual_mean_diff_2', 'rkg_3', 'qual_mean_diff_1', 'freq_C_3', 'qual_mean_diff_3', 'qual_variance_3', 'qual_mean_3', 'qual_variance_1', 'qual_mean_diff', 'qual_variance_2', 'qual_variance', 'lzma_1', 'dkg_4', 'lzma', 'dkg_2', 'dkg_3', 'lzma_2', 'lzma_3', 'qual_min_1', 'rkg_2', 'qual_min_2', 'qual_min_3', 'freq_C_1', 'run_max_length', 'qual_min', 'qual_max_3', 'qual_max_1', 'qual_max_2', 'qual_max', 'qual_skewness_1', 'qual_skewness_2', 'qual_skewness_3', 'qual_skewness']
l7 = ['lzma_2', 'bz2_1', 'run_mean', 'freq_C', 'freq_T_1', 'freq_T_2', 'dust_1', 'bz2_2', 'freq_A', 'lzma_3', 'freq_G', 'dust_2', 'freq_T', 'bz2_3', 'freq_G_2', 'run_variance', 'freq_A_1', 'dust', 'dust_3', 'freq_C_3', 'qual_variance_1', 'freq_A_2', 'entropy', 'qual_variance', 'freq_G_1', 'bz2', 'entropy_3', 'freq_G_3', 'freq_A_3', 'freq_T_3', 'qual_mean_diff', 'entropy_1', 'dkg_5', 'entropy_2', 'freq_C_2', 'dkg_4', 'rkg_3', 'rkg_4', 'qual_mean', 'dkg_2', 'qual_mean_1', 'rkg_5', 'qual_mean_2', 'qual_mean_diff_3', 'qual_variance_2', 'qual_mean_diff_1', 'qual_mean_diff_2', 'qual_mean_3', 'qual_variance_3', 'run_max_length', 'dkg_3', 'lzma', 'lzma_1', 'qual_min_2', 'qual_min_1', 'qual_max_1', 'qual_min_3', 'qual_max_2', 'qual_min', 'freq_C_1', 'rkg_2', 'qual_max_3', 'qual_max', 'qual_skewness_1', 'qual_skewness_2', 'qual_skewness_3', 'qual_skewness']
l8 = ['dust', 'run_variance', 'dkg_5', 'run_max_length', 'dust_2', 'run_mean', 'entropy', 'dust_3', 'qual_mean_3', 'freq_T_2', 'entropy_2', 'freq_A_3', 'entropy_3', 'freq_T_3', 'qual_skewness_3', 'freq_T', 'freq_A', 'qual_mean_2', 'freq_G_2', 'freq_G', 'dkg_2', 'qual_mean_diff_2', 'qual_mean_diff_3', 'freq_G_3', 'freq_C', 'freq_C_3', 'qual_mean', 'rkg_4', 'rkg_3', 'rkg_5', 'qual_mean_1', 'entropy_1', 'qual_mean_diff_1', 'freq_A_2', 'dust_1', 'qual_mean_diff', 'freq_C_2', 'qual_skewness_1', 'qual_skewness_2', 'dkg_4', 'bz2', 'freq_A_1', 'bz2_3', 'qual_skewness', 'bz2_2', 'freq_G_1', 'rkg_2', 'dkg_3', 'freq_T_1', 'qual_variance_1', 'qual_min_3', 'bz2_1', 'qual_variance_3', 'qual_variance', 'qual_variance_2', 'freq_C_1', 'qual_max_2', 'qual_max_3', 'qual_max', 'lzma', 'lzma_2', 'qual_max_1', 'lzma_3', 'qual_min_1', 'qual_min_2', 'lzma_1', 'qual_min']
l9 = ['freq_A_1', 'entropy_1', 'freq_G_1', 'run_mean', 'freq_T_3', 'run_variance', 'qual_mean_3', 'entropy_3', 'entropy', 'qual_skewness_3', 'freq_C_1', 'freq_T_2', 'freq_C_3', 'dust_3', 'entropy_2', 'dust', 'qual_mean_diff_2', 'freq_C', 'freq_A', 'dust_1', 'qual_mean_diff_3', 'qual_mean_diff_1', 'qual_mean_1', 'dust_2', 'freq_T', 'qual_mean_2', 'freq_G', 'dkg_5', 'freq_G_3', 'qual_mean', 'rkg_3', 'freq_A_3', 'qual_mean_diff', 'rkg_4', 'freq_T_1', 'qual_skewness_2', 'qual_variance_1', 'rkg_5', 'freq_G_2', 'freq_C_2', 'freq_A_2', 'qual_skewness_1', 'bz2', 'dkg_4', 'dkg_3', 'qual_skewness', 'run_max_length', 'qual_variance', 'dkg_2', 'bz2_3', 'bz2_2', 'qual_max_3', 'bz2_1', 'qual_variance_2', 'rkg_2', 'qual_max_2', 'qual_variance_3', 'qual_max', 'qual_min_3', 'lzma', 'qual_max_1', 'lzma_3', 'qual_min_1', 'lzma_2', 'qual_min_2', 'lzma_1', 'qual_min']
l10 = ['qual_mean_3', 'run_variance', 'freq_C_3', 'entropy_3', 'qual_variance', 'run_max_length', 'qual_mean', 'dust', 'dust_3', 'entropy', 'entropy_1', 'dust_2', 'dust_1', 'run_mean', 'entropy_2', 'bz2', 'rkg_4', 'rkg_5', 'freq_A', 'qual_variance_3', 'rkg_3', 'qual_mean_1', 'freq_T', 'qual_mean_2', 'dkg_5', 'qual_variance_2', 'qual_variance_1', 'freq_G', 'freq_A_1', 'freq_A_2', 'qual_mean_diff_2', 'freq_A_3', 'freq_G_1', 'bz2_1', 'bz2_2', 'freq_T_3', 'freq_G_2', 'qual_mean_diff_3', 'bz2_3', 'freq_T_1', 'dkg_4', 'freq_G_3', 'freq_T_2', 'dkg_3', 'freq_C', 'qual_mean_diff_1', 'lzma', 'qual_skewness_2', 'qual_mean_diff', 'qual_skewness_1', 'qual_skewness_3', 'rkg_2', 'dkg_2', 'qual_skewness', 'freq_C_1', 'lzma_2', 'lzma_3', 'lzma_1', 'freq_C_2', 'qual_max_2', 'qual_max_3', 'qual_max', 'qual_max_1', 'qual_min_3', 'qual_min_2', 'qual_min_1', 'qual_min']
l11 = ['freq_C_3', 'dust', 'run_variance', 'dust_2', 'entropy', 'run_mean', 'qual_mean', 'dust_1', 'dust_3', 'qual_mean_3', 'freq_A', 'entropy_2', 'entropy_1', 'entropy_3', 'rkg_4', 'freq_T', 'rkg_5', 'freq_G', 'run_max_length', 'dkg_5', 'bz2', 'freq_T_1', 'rkg_3', 'freq_C', 'freq_G_3', 'dkg_3', 'freq_G_1', 'freq_A_1', 'freq_A_3', 'freq_G_2', 'dkg_4', 'bz2_1', 'bz2_2', 'qual_mean_1', 'qual_variance_1', 'qual_variance_3', 'bz2_3', 'freq_A_2', 'qual_mean_2', 'qual_variance_2', 'qual_mean_diff_2', 'qual_variance', 'qual_mean_diff_3', 'freq_T_3', 'freq_T_2', 'freq_C_1', 'lzma', 'qual_skewness_2', 'qual_mean_diff_1', 'qual_mean_diff', 'qual_skewness_3', 'qual_skewness_1', 'rkg_2', 'qual_skewness', 'dkg_2', 'lzma_2', 'lzma_3', 'lzma_1', 'freq_C_2', 'qual_max_2', 'qual_max_3', 'qual_max', 'qual_max_1', 'qual_min_3', 'qual_min_2', 'qual_min_1', 'qual_min']


bs_illumina = [l1, l2, l3, l10, l11]
bs_ion_torrent = [l6, l7]
reg_ion_torrent = [l3, l4]
reg_illumina = [l8, l9]
full = [l1, l2, l3, l4, l5, l6, l7, l8, l9, l10, l11]

from collections import defaultdict
import statistics
import matplotlib.pyplot as plt
import seaborn as sns

sns.set()

def get_average_ranks(data_lists):
    feature_locations = defaultdict(list)
    for li in data_lists:
        for i, feature in enumerate(li):
            feature_locations[feature].append(i)
    feature_averages = []
    for feature in feature_locations:
        feature_averages.append(
            (sum(feature_locations[feature])/
             len(feature_locations[feature]), feature,
             statistics.stdev(feature_locations[feature])))
    feature_averages.sort()
    return feature_averages, feature_locations

full_averages, full_feature_locations = get_average_ranks(full)
print("Full Averages")
for item in full_averages:
    print(item)

def remove_thirds(averages_list):
    return [item for item in averages_list if
                            ('dkg_2' in item[1] or 'rkg_2' in item[1] or
                            'dkg_3' in item[1] or 'rkg_3' in item[1]) or
                            ('_1' not in item[1] and '_2' not in item[1] and
                            '_3' not in item[1])]

def keep_thirds(averages_list):
    not_thirds = [item[1] for item in remove_thirds(averages_list)]
    return [item for item in averages_list if item[1] not in not_thirds]

reg_illumina_averages, reg_illumina_locations = get_average_ranks(reg_illumina)
bs_illumina_averages, bs_illumina_locations = get_average_ranks(bs_illumina)
reg_averages, reg_locations = get_average_ranks(reg_illumina + reg_ion_torrent)

full_averages_removed = remove_thirds(full_averages)
full_averages_thirds = keep_thirds(full_averages)

reg_illumina_removed = remove_thirds(reg_illumina_averages)
bs_illumina_removed = remove_thirds(bs_illumina_averages)
reg_removed = remove_thirds(reg_averages)

import scipy.stats as stats

kendall_tau_list = [l1, l2, l3, l4, l6, l7, l8, l9, l10, l11]
kendall_tau_comparison = l5

kendall_tau_bispin = [l2, l6, l11]
self_comparisons = []
other_comparisons = []
stack = []
for i, l0 in enumerate(kendall_tau_list):
    if i % 2 == 1:
        tau2, p_value2 = stats.kendalltau(l0, kendall_tau_comparison)
        tau1, p_value1 = stack.pop()
        tau_avg = (tau1 + tau2) / 2
        p_value_avg = (p_value1 +  p_value2) / 2
        other_comparisons.append((tau_avg, p_value_avg))
    else:
        tau, p_value = stats.kendalltau(l0, kendall_tau_list[i+1])
        tau1, p_value1 = stats.kendalltau(l0, kendall_tau_comparison)
        stack.append((tau1, p_value1))
        self_comparisons.append((tau, p_value))

print('BisPin kt comparison')
for i, l0 in enumerate(kendall_tau_bispin):
    tau, p_value = stats.kendalltau(l0, kendall_tau_comparison)
    print((tau, p_value))

print('Self comparisons')
for item in self_comparisons:
    print(item)

print('Other comparisons')
for item in other_comparisons:
    print(item)

plot_selector = 2

if plot_selector == 0:

    plt.boxplot([full_feature_locations[item[1]] for item in full_averages_removed],
                notch=True, labels=[item[1] for item in full_averages_removed],
                )
    plt.xticks(rotation=45)
    plt.title('Median and Variance for Random Forest Feature Importance Ranks on All Data')
    plt.xlabel('Feature')
    plt.ylabel('Random Forest Importance Rank')
    plt.tight_layout()

    plt.show()

elif plot_selector == 1:

    plt.boxplot([reg_illumina_locations[item[1]] for item in reg_illumina_removed],
                notch=True, labels=[item[1] for item in reg_illumina_removed],
                )
    plt.xticks(rotation=45)
    plt.title('Median and Variance for Random Forest Feature Importance Ranks on Regular Illumina')
    plt.xlabel('Feature')
    plt.ylabel('Random Forest Importance Rank')
    plt.tight_layout()

    plt.show()

elif plot_selector == 2:

    plt.boxplot([bs_illumina_locations[item[1]] for item in bs_illumina_removed],
                notch=True, labels=[item[1] for item in bs_illumina_removed],
                )
    plt.xticks(rotation=45)
    plt.title('Median and Variance for Random Forest Feature Importance Ranks on BS Illumina')
    plt.xlabel('Feature')
    plt.ylabel('Random Forest Importance Rank')
    plt.tight_layout()

    plt.show()

elif plot_selector == 3:
    plt.boxplot([full_feature_locations[item[1]] for item in full_averages_thirds],
                notch=True, labels=[item[1] for item in full_averages_thirds],
                )
    plt.xticks(rotation=45)
    plt.title('Median and Variance for Random Forest Feature Importance Ranks on Thirds Features')
    plt.xlabel('Feature')
    plt.ylabel('Random Forest Importance Rank')
    plt.tight_layout()

    plt.show()

elif plot_selector == 4:
    plt.boxplot([reg_locations[item[1]] for item in reg_removed],
                notch=True, labels=[item[1] for item in reg_removed],
                )
    plt.xticks(rotation=45)
    plt.title('Median and Variance for Random Forest Feature Importance Ranks on Regular Reads')
    plt.xlabel('Feature')
    plt.ylabel('Random Forest Importance Rank')
    plt.tight_layout()

    plt.show()

